import{g as R,ah as V,a7 as Z,r as v,ai as ae,j as te,S as le,T as ne,A as T,Q as F,J as a,I as e,ac as M,L as se,B as E,V as oe,W as re,K as t,ae as J,aa as U,a9 as G,ak as ie,E as ue,l as b,a8 as de,al as K,U as pe,ab as L,ad as q,aj as me,af as ce,ag as _e}from"./index-8610761f.js";import{_ as Q,b as fe,c as ve,u as ge,a as ye}from"./table-77f481ad.js";import{_ as W}from"./TreeSelect-15b66a93.js";import{_ as H}from"./Grid-b49ce893.js";import{_ as X}from"./FormItem-99ac4921.js";import{_ as be}from"./Scrollbar-15d9e571.js";const we=R({name:"UserOperateModal"}),he=R({...we,props:V({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(D,{emit:w}){const m=D,S=w,h=Z(),k=v(null),_=v([]),g=ae(D,"visible"),d=te(()=>({add:"新增用户",edit:"编辑用户"})[m.operateType]);function I(){g.value=!1}const l=le(f());function f(){return{username:"",password:"",workno:"",departName:"0",displayname:"",deptId:null,mail:"",phone:"",disableUser:"0"}}const N={username:{required:!0,trigger:["blur","input"],message:"请输入登录名"},password:{required:!0,trigger:["blur","input"],message:"请输入密码"},deptId:{required:!0,type:"number",trigger:["blur","change"],message:"请选择部门"},mail:{required:!1,pattern:/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,trigger:["blur"],message:"请输入有效的邮箱地址"},phone:{required:!1,pattern:/((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/,trigger:["blur","change"],message:"请输入有效的电话号码"}};function z(){Object.assign(l,f()),m.rowData&&m.operateType==="edit"&&Object.assign(l,m.rowData,{id:m.rowData.userId})}async function C(){var u;console.log(l),(u=k.value)==null||u.validate(async s=>{s||(m.operateType==="add"?await h.addSystemUser(l):await h.putSystemUser(l),I(),S("submitted"))})}ne(g,async()=>{var u;g.value&&(await $(),z(),console.log(l),(u=k.value)==null||u.restoreValidation())});const $=async()=>{const u=await h.getSystemOrganizationalTree();u.code===200&&(_.value=u.data)};return(u,s)=>{const O=W,p=Q,c=J,o=fe,r=ve,P=H,y=X,j=be,x=U,A=G,B=ie;return T(),F(B,{show:g.value,"onUpdate:show":s[8]||(s[8]=n=>g.value=n),title:d.value,preset:"card",class:"w-800px"},{footer:a(()=>[e(A,{justify:"end",size:16},{default:a(()=>[e(x,{onClick:I},{default:a(()=>[M("取消")]),_:1}),e(x,{type:"primary",onClick:C},{default:a(()=>[M(" 确认 ")]),_:1})]),_:1})]),default:a(()=>[e(j,{class:"h-240px pr-20px"},{default:a(()=>[e(y,{ref_key:"formRoleRef",ref:k,model:l,rules:N,"label-placement":"left","label-width":100},{default:a(()=>[e(P,{responsive:"screen","item-responsive":""},{default:a(()=>[e(p,{span:"24 m:12",label:"部门",path:"deptId"},{default:a(()=>[e(O,{value:l.deptId,"onUpdate:value":s[0]||(s[0]=n=>l.deptId=n),filterable:"",options:_.value,"key-field":"id","label-field":"name",clearable:"",placeholder:"请选择部门"},null,8,["value","options"])]),_:1}),e(p,{span:"24 m:12",label:"工号",path:"workno"},{default:a(()=>[e(c,{value:l.workno,"onUpdate:value":s[1]||(s[1]=n=>l.workno=n),placeholder:"请输入工号"},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"登录名",path:"username"},{default:a(()=>[e(c,{value:l.username,"onUpdate:value":s[2]||(s[2]=n=>l.username=n),placeholder:"请输入登录名"},null,8,["value"])]),_:1}),m.operateType==="add"?(T(),F(p,{key:0,span:"24 m:12",label:"密码",path:"password"},{default:a(()=>[e(c,{value:l.password,"onUpdate:value":s[3]||(s[3]=n=>l.password=n),type:"password",placeholder:"请输入密码"},null,8,["value"])]),_:1})):se("",!0),e(p,{span:"24 m:12",label:"姓名",path:"displayname"},{default:a(()=>[e(c,{value:l.displayname,"onUpdate:value":s[4]||(s[4]=n=>l.displayname=n),placeholder:"请输入姓名"},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"手机号",path:"phone"},{default:a(()=>[e(c,{value:l.phone,"onUpdate:value":s[5]||(s[5]=n=>l.phone=n),placeholder:"请输入手机号"},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"邮箱",path:"mail"},{default:a(()=>[e(c,{value:l.mail,"onUpdate:value":s[6]||(s[6]=n=>l.mail=n),placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),e(p,{span:"24 m:12",label:"是否启用",path:"disableRole"},{default:a(()=>[e(r,{value:l.disableUser,"onUpdate:value":s[7]||(s[7]=n=>l.disableUser=n)},{default:a(()=>[(T(!0),E(oe,null,re(t(h).roleSwatchOptions,n=>(T(),F(o,{key:n.value,value:n.value,label:n.label},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),ke={class:"flex-vertical-stretch gap-16px overflow-hidden <sm:overflow-auto"},Ue=R({name:"SystemManagementUser"}),Ce=R({...Ue,setup(D){var c;(c=ue())==null||c.proxy;const w=Z(),{columns:m,columnChecks:S,data:h,loading:k,getData:_,pagination:g,searchParams:d,resetSearchParams:I}=ge({apiFn:w.getSystemUserList,showTotal:!0,apiParams:{current:1,size:10,deptId:null,username:null,displayname:null,level:1},columns:()=>[{key:"index",title:"序号",width:64,align:"center"},{key:"username",title:"登录名",width:120,align:"center"},{key:"workno",title:"工号",width:120,align:"center"},{key:"displayname",title:"姓名",width:120,align:"center"},{key:"phone",title:"手机号",width:120,align:"center"},{key:"mail",title:"邮箱",width:120,align:"center"},{key:"disableUser",title:"是否启用",width:120,align:"center",render:o=>b(de,{type:o.disableUser==="1"?"error":"success"},{default:()=>o.disableUser==="1"?"否":"是"})},{key:"active",title:"操作",width:140,align:"center",render:o=>b(G,{justify:"center"},{default:()=>[b(U,{size:"small",type:"primary",ghost:!0,onClick:()=>{N.value="edit",z.value={...o},f.value=!0}},{default:()=>"编辑"}),b(K,{onPositiveClick:()=>s(o)},{default:()=>"确认删除吗？",trigger:()=>b(U,{size:"small",type:"error",ghost:!0},{default:()=>"删除"})}),b(K,{onPositiveClick:()=>O(o)},{default:()=>"确认重置密码吗？",trigger:()=>b(U,{size:"small",type:"warning",ghost:!0},{default:()=>"重置密码"})})]})}],immediate:void 0}),l=v([]),f=v(!1),N=v("add"),z=v(void 0),C=v([]),$=v([{label:"本级",value:1},{label:"本级及下级",value:2}]),u=()=>{N.value="add",f.value=!0},s=async o=>{await w.delSystemUser(o.userId),_()},O=async o=>{await w.putSystemUserResetPwd(o.userId),_()},p=async()=>{const o=await w.getSystemOrganizationalTree();o.code===200&&(C.value=o.data)};return pe(async()=>{await p()}),(o,r)=>{const P=W,y=Q,j=me,x=J,A=H,B=X,n=ce,Y=_e,ee=ye;return T(),E("div",ke,[e(n,{title:"搜索",bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(B,{model:t(d),"label-placement":"left","label-width":80},{default:a(()=>[e(A,{responsive:"screen","item-responsive":""},{default:a(()=>[e(y,{span:"24 s:12 m:5",label:"组织",path:"username",class:"pr-24px"},{default:a(()=>[e(P,{value:t(d).deptId,"onUpdate:value":r[0]||(r[0]=i=>t(d).deptId=i),filterable:"",options:t(C),"default-value":"Drive My Car","key-field":"id","label-field":"name",clearable:"",placeholder:"请选择组织"},null,8,["value","options"])]),_:1}),e(y,{span:"24 s:12 m:5",label:"本级",path:"username",class:"pr-24px"},{default:a(()=>[e(j,{value:t(d).level,"onUpdate:value":r[1]||(r[1]=i=>t(d).level=i),options:t($)},null,8,["value","options"])]),_:1}),e(y,{span:"24 s:12 m:5",label:"姓名",path:"displayname",class:"pr-24px"},{default:a(()=>[e(x,{value:t(d).displayname,"onUpdate:value":r[2]||(r[2]=i=>t(d).displayname=i),placeholder:"请输入姓名"},null,8,["value"])]),_:1}),e(y,{span:"24 s:12 m:5",label:"登录名",path:"username",class:"pr-24px"},{default:a(()=>[e(x,{value:t(d).username,"onUpdate:value":r[3]||(r[3]=i=>t(d).username=i),placeholder:"请输入登录名"},null,8,["value"])]),_:1}),e(y,{span:"24 s:12 m:4"},{default:a(()=>[e(t(G),{class:"w-full",justify:"end"},{default:a(()=>[e(t(U),{type:"primary",ghost:"",onClick:t(_)},{icon:a(()=>[e(L,{icon:"icon-sousuo1"})]),default:a(()=>[M(" 搜索 ")]),_:1},8,["onClick"]),e(t(U),{onClick:t(I)},{icon:a(()=>[e(L,{icon:"icon-shuaxin-01"})]),default:a(()=>[M(" 清空 ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(n,{title:"用户管理",bordered:!1,size:"small",class:"card-wrapper sm:flex-1-hidden"},{"header-extra":a(()=>[e(Y,{columns:t(S),"onUpdate:columns":r[4]||(r[4]=i=>q(S)?S.value=i:null),"is-delete-btn":!1,loading:t(k),onAdd:u,onRefresh:t(_)},null,8,["columns","loading","onRefresh"])]),default:a(()=>[e(ee,{"checked-row-keys":t(l),"onUpdate:checkedRowKeys":r[5]||(r[5]=i=>q(l)?l.value=i:null),columns:t(m),data:t(h),size:"small","flex-height":!0,remote:!0,"scroll-x":640,loading:t(k),pagination:t(g),"row-key":i=>i.id,class:"sm:h-full"},null,8,["checked-row-keys","columns","data","loading","pagination","row-key"]),e(he,{visible:t(f),"onUpdate:visible":r[6]||(r[6]=i=>q(f)?f.value=i:null),"operate-type":t(N),"row-data":t(z),onSubmitted:t(_)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Ce as default};
