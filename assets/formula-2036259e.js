import{g as G,ah as Q,r as c,ai as re,S as be,T as X,A as E,Q as Y,J as n,I as t,ac as M,M as je,K as e,ad as O,L as Me,D as P,aj as _e,aa as $,a9 as J,ak as ye,t as Z,ae as Re,l as x,al as oe,B as he,aE as Oe,V as Se,ag as Ge,aD as Ve,W as We,G as ge,av as Le,R as Ee,P as He,by as Ke,j as K,p as ve,U as Je,H as Qe,a0 as Xe,b7 as Ye,bz as Ze,ab as et,bA as tt,af as at,bB as lt,bC as it,_ as nt}from"./index-c17896f8.js";import{u as ae}from"./index-1e2be4ca.js";import{_ as De}from"./InputNumber-289ff6dd.js";import{_ as we}from"./FormItemGridItem-7a584310.js";import{_ as ue,a as st}from"./Grid-5bd7fcd6.js";import{_ as Ce}from"./FormItem-af78cc3d.js";import{_ as Ie}from"./Scrollbar-bf5eb4f1.js";import{u as ot}from"./table-a84f3163.js";import{_ as Ue}from"./DataTable-19a8255a.js";import"./Add-1bbcdd6f.js";import"./Forward-600c26c3.js";const rt=P("span",{class:"p-x-8px"},"<",-1),ut=G({name:"MaterailCreateModal"}),dt=G({...ut,props:Q({rowData:{},materialCategory:{},series:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Q(["submitted"],["update:visible"]),setup(z,{emit:g}){const D=z,B=g,k=ae(),w=c(null),N=re(z,"visible");function y(){N.value=!1}const C=be(p());function p(){return{materialInfo:"",weight:0,resubmissionCount:""}}const l={materialInfo:{required:!0,trigger:["blur","change"],message:"请选择物料大类"},weight:{required:!0,validator(_,d){if(d){if(Number(d)<=0)return new Error("重量不能为0")}else return new Error("需要重量");return!0},trigger:["input","blur"]}};function b(){Object.assign(C,p())}const A=c([]),I=c(!1);async function U(_){I.value=!0;const d=await k.queryMaterialClassification({current:1,size:999,series:D.series,materialClassification:_});d.code===200&&(A.value=d.data.map(r=>({label:r,value:r}))),I.value=!1}const f=c(1),v=c(1);async function R(){var d;const _=[];for(let r=f.value;r<=v.value;r++)_.push(r);B("submitted",_),(d=w.value)==null||d.validate(async r=>{r||(k.addMaterialCategory(D.materialCategory,Object.assign({},C,D.materialCategory==="segmentationData"?{resubmissionCount:[f.value,v.value]}:{})),y())})}return X(N,()=>{var _;N.value&&(b(),A.value=[],console.log(C),(_=w.value)==null||_.restoreValidation())}),(_,d)=>{const r=De,u=we,s=_e,h=ue,j=Ce,V=Ie,W=$,L=J,H=ye;return E(),Y(H,{show:N.value,"onUpdate:show":d[4]||(d[4]=m=>N.value=m),title:"添加物料大类",preset:"card",class:"w-500px"},{footer:n(()=>[t(L,{justify:"end",size:16},{default:n(()=>[t(W,{onClick:y},{default:n(()=>[M("取消")]),_:1}),t(W,{type:"primary",onClick:R},{default:n(()=>[M(" 确认 ")]),_:1})]),_:1})]),default:n(()=>[t(V,{class:je(["h-130px pr-20px",{"h-190px":_.materialCategory==="segmentationData"}])},{default:n(()=>[t(j,{ref_key:"formRoleRef",ref:w,model:e(C),rules:l,"label-placement":"left","label-width":100},{default:n(()=>[t(h,{responsive:"screen","item-responsive":""},{default:n(()=>[_.materialCategory==="segmentationData"?(E(),Y(u,{key:0,span:"24 m:24",label:"复投阶段"},{default:n(()=>[t(r,{value:e(f),"onUpdate:value":d[0]||(d[0]=m=>O(f)?f.value=m:null),step:.1,min:0,max:e(v)},null,8,["value","max"]),rt,t(r,{value:e(v),"onUpdate:value":d[1]||(d[1]=m=>O(v)?v.value=m:null),step:1,min:e(f)},null,8,["value","min"])]),_:1})):Me("",!0),t(u,{span:"24 m:24",label:"物料大类",path:"materialInfo"},{default:n(()=>[t(s,{value:e(C).materialInfo,"onUpdate:value":d[2]||(d[2]=m=>e(C).materialInfo=m),filterable:"",placeholder:"输入物料名称",options:e(A),loading:e(I),clearable:"",remote:"",onSearch:U},null,8,["value","options","loading"])]),_:1}),t(u,{span:"24 m:24",label:"装料重量",path:"weight"},{default:n(()=>[t(r,{value:e(C).weight,"onUpdate:value":d[3]||(d[3]=m=>e(C).weight=m),class:"w-full",clearable:"",placeholder:"请输入装料重量"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["class"])]),_:1},8,["show"])}}}),ct=G({name:"SubMaterailCreateModal"}),pt=G({...ct,props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:Q(["submitted"],["update:visible"]),setup(z,{emit:g}){const D=g,B=ae(),k=c(null),w=Z("series"),N=Z("subMaterialRowData"),y=re(z,"visible");function C(){y.value=!1}const p=be(l());function l(){return{series:"",materialNo:"",materialName:"",productClassification:"",rawMaterialClassification:"",brand:"",resistivity:"",materialClassification:""}}const b={materialNo:{required:!0,trigger:["blur","change"],message:"请选择物品条码"},brand:{required:!0,trigger:["blur","input"],message:"请输入厂牌"},resistivity:{required:!0,trigger:["blur","input"],message:"请输入电阻率"},productClassification:{required:!0,trigger:["blur","input"],message:"请输入产品分类"},rawMaterialClassification:{required:!0,trigger:["blur","input"],message:"请输入原料分类"}};function A(){Object.assign(p,l())}async function I(){var d;(d=k.value)==null||d.validate(async r=>{r||(await B.addMaterialFormulaSub({series:w==null?void 0:w.value,materialNo:p.materialNo,materialName:v.value.name,productClassification:p.productClassification,rawMaterialClassification:p.rawMaterialClassification,brand:p.brand,resistivity:p.resistivity,materialClassification:N==null?void 0:N.value.materialInfo}),D("submitted"),C())})}const U=c([]),f=c(!1),v=c();async function R(d){f.value=!0;const r=await B.queryMaterialMaster({current:1,size:999,code:d});r.code===200&&(U.value=r.data.records),f.value=!1}const _=d=>{v.value=U.value.find(r=>r.code===d),console.log(v)};return X(y,()=>{var d;y.value&&(A(),U.value=[],console.log(p),(d=k.value)==null||d.restoreValidation())}),(d,r)=>{const u=_e,s=we,h=Re,j=ue,V=Ce,W=Ie,L=$,H=J,m=ye;return E(),Y(m,{show:y.value,"onUpdate:show":r[5]||(r[5]=S=>y.value=S),title:"添加物料明细",preset:"card",class:"w-500px"},{footer:n(()=>[t(H,{justify:"end",size:16},{default:n(()=>[t(L,{onClick:C},{default:n(()=>[M("取消")]),_:1}),t(L,{type:"primary",onClick:I},{default:n(()=>[M(" 确认 ")]),_:1})]),_:1})]),default:n(()=>[t(W,{class:"h-300px pr-20px"},{default:n(()=>[t(V,{ref_key:"formRoleRef",ref:k,model:e(p),rules:b,"label-placement":"left","label-width":100},{default:n(()=>[t(j,{responsive:"screen","item-responsive":""},{default:n(()=>[t(s,{span:"24 m:24",label:"物料明细",path:"materialNo"},{default:n(()=>[t(u,{value:e(p).materialNo,"onUpdate:value":r[0]||(r[0]=S=>e(p).materialNo=S),filterable:"",placeholder:"搜索物料明细编码",options:e(U),loading:e(f),"label-field":"code","value-field":"code","consistent-menu-width":!1,clearable:"",remote:"",onSearch:R,onChange:_},null,8,["value","options","loading"])]),_:1}),t(s,{span:"24 m:24",label:"厂牌",path:"brand"},{default:n(()=>[t(h,{value:e(p).brand,"onUpdate:value":r[1]||(r[1]=S=>e(p).brand=S),class:"w-full",clearable:"",placeholder:"请输入厂牌"},null,8,["value"])]),_:1}),t(s,{span:"24 m:24",label:"电阻率",path:"resistivity"},{default:n(()=>[t(h,{value:e(p).resistivity,"onUpdate:value":r[2]||(r[2]=S=>e(p).resistivity=S),class:"w-full",clearable:"",placeholder:"请输入电阻率"},null,8,["value"])]),_:1}),t(s,{span:"24 m:24",label:"产品分类",path:"productClassification"},{default:n(()=>[t(h,{value:e(p).productClassification,"onUpdate:value":r[3]||(r[3]=S=>e(p).productClassification=S),class:"w-full",clearable:"",placeholder:"请输入产品分类"},null,8,["value"])]),_:1}),t(s,{span:"24 m:24",label:"原料分类",path:"rawMaterialClassification"},{default:n(()=>[t(h,{value:e(p).rawMaterialClassification,"onUpdate:value":r[4]||(r[4]=S=>e(p).rawMaterialClassification=S),class:"w-full",clearable:"",placeholder:"请输入原料分类"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}}),mt={class:"h-full flex flex-col"},ft=G({name:"SubMaterialDrawer"}),vt=G({...ft,props:Q({subMaterialTitle:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(z){const g=ae(),D=re(z,"visible"),B=c([]),k=Z("series"),w=Z("subMaterialRowData"),{columns:N,columnChecks:y,data:C,loading:p,getData:l,pagination:b,searchParams:A}=ot({apiFn:g.queryMaterialFormulaSub,apiParams:{current:1,size:10},showTotal:!0,immediate:!1,columns:()=>[{key:"index",title:"序号",width:60,align:"center",fixed:"left"},{key:"series",title:"系列",width:60,align:"center",fixed:"left"},{key:"materialNo",title:"物料编号",width:120,align:"center",fixed:"left"},{key:"displayname",title:"库存量",width:100,align:"center"},{key:"materialName",title:"物料名称",width:220,align:"center"},{key:"mail",title:"虚拟炉台",width:80,align:"center"},{key:"productClassification",title:"产品分类",width:80,align:"center"},{key:"rawMaterialClassification",title:"原料分类",width:80,align:"center"},{key:"brand",title:"厂牌",width:80,align:"center"},{key:"resistivity",title:"电阻率",width:80,align:"center"},{key:"active",title:"操作",width:120,align:"center",fixed:"right",render:v=>x(J,{justify:"center"},{default:()=>[x(oe,{onPositiveClick:()=>U(v)},{default:()=>"确认删除吗？",trigger:()=>x($,{size:"small",type:"error",ghost:!0},{default:()=>"删除"})})]})}]}),I=()=>{f.value=!0},U=async v=>{await g.deleteMaterialFormulaSub({id:v.id}),l()},f=c(!1);return X(D,async v=>{v&&(w!=null&&w.value)&&(A.materialClassification=w==null?void 0:w.value.materialInfo,A.series=k==null?void 0:k.value,await l())}),(v,R)=>{const _=Ge,d=Ue,r=Ve;return E(),he(Se,null,[t(e(Oe),{show:D.value,"onUpdate:show":R[2]||(R[2]=u=>D.value=u),width:"70%"},{default:n(()=>[t(r,{title:v.subMaterialTitle,closable:""},{default:n(()=>[P("div",mt,[t(_,{columns:e(y),"onUpdate:columns":R[0]||(R[0]=u=>O(y)?y.value=u:null),class:"flex-1 p-y-12px","is-delete-btn":!1,loading:e(p),onAdd:I,onRefresh:e(l)},null,8,["columns","loading","onRefresh"]),t(d,{"checked-row-keys":e(B),"onUpdate:checkedRowKeys":R[1]||(R[1]=u=>O(B)?B.value=u:null),columns:e(N),data:e(C),size:"small","flex-height":!0,remote:!0,"scroll-x":640,loading:e(p),pagination:e(b),"row-key":u=>u.id,class:"sm:h-full"},null,8,["checked-row-keys","columns","data","loading","pagination","row-key"])])]),_:1},8,["title"])]),_:1},8,["show"]),t(pt,{visible:e(f),"onUpdate:visible":R[3]||(R[3]=u=>O(f)?f.value=u:null),onSubmitted:e(l)},null,8,["visible","onSubmitted"])],64)}}}),gt={class:"button-group m-b-12px"},bt=G({name:"CheckedPlatformModal"}),_t=G({...bt,props:Q({furnaceNum:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Q(["submitted"],["update:visible"]),setup(z,{emit:g}){const D=z,B=g,k=ae();c(null);const w=Z("module"),N=Z("series"),y=re(z,"visible");function C(){y.value=!1}const p=c(""),l=c(Array.from({length:90},(u,s)=>s+1)),b=c(Array(l.value.length).fill(!1)),A=c(!1),I=c(!1),U=c(!1),f=Math.ceil(l.value.length/2),v=()=>{b.value=Array(l.value.length).fill(A.value)},R=u=>{if(u==="first")for(let s=0;s<f;s++)b.value[s]=I.value;else if(u==="second")for(let s=f;s<l.value.length;s++)b.value[s]=U.value;d()},_=u=>{let s;if(u==="all"){const h=b.value.filter(Boolean).length;return h>0&&h<l.value.length}else{if(u==="first")return s=b.value.slice(0,f).filter(Boolean).length,s>0&&s<f;if(u==="second")return s=b.value.slice(f).filter(Boolean).length,s>0&&s<l.value.length-f}return!1},d=()=>{const u=b.value.slice(0,f).every(Boolean),s=b.value.slice(f).every(Boolean);I.value=u,U.value=s,A.value=u&&s};X(b,d);async function r(){p.value=l.value.filter((u,s)=>b.value[s]).join(", "),console.log(l.value.filter((u,s)=>b.value[s])),B("submitted",l.value.filter((u,s)=>b.value[s])),C()}return X(y,async()=>{if(console.log(y),y.value){const u=await k.queryDeviceNums({series:N==null?void 0:N.value,module:w==null?void 0:w.value});if(u.code===200){l.value=u.data;const s=D.furnaceNum.split(",").map(h=>h.trim());console.log(s),s.forEach(h=>{const j=l.value.findIndex(V=>V===Number(h));j!==-1&&(b.value[j]=!0)}),d()}}}),(u,s)=>{const h=Le,j=st,V=ue,W=$,L=J,H=ye;return E(),Y(H,{show:y.value,"onUpdate:show":s[5]||(s[5]=m=>y.value=m),title:"选择炉台",preset:"card",class:"w-900px"},{footer:n(()=>[t(L,{justify:"end",size:16},{default:n(()=>[t(W,{onClick:C},{default:n(()=>[M("取消")]),_:1}),t(W,{type:"primary",onClick:r},{default:n(()=>[M(" 确认 ")]),_:1})]),_:1})]),default:n(()=>[P("div",gt,[t(h,{checked:A.value,"onUpdate:checked":[s[0]||(s[0]=m=>A.value=m),v],indeterminate:_("all")},{default:n(()=>[M(" 全选 ")]),_:1},8,["checked","indeterminate"]),t(h,{checked:I.value,"onUpdate:checked":[s[1]||(s[1]=m=>I.value=m),s[2]||(s[2]=m=>R("first"))],indeterminate:_("first")},{default:n(()=>[M(" 勾选前半段 ")]),_:1},8,["checked","indeterminate"]),t(h,{checked:U.value,"onUpdate:checked":[s[3]||(s[3]=m=>U.value=m),s[4]||(s[4]=m=>R("second"))],indeterminate:_("second")},{default:n(()=>[M(" 勾选后半段 ")]),_:1},8,["checked","indeterminate"])]),t(V,{"x-gap":"12","y-gap":"12",cols:"6"},{default:n(()=>[(E(!0),he(Se,null,We(l.value,(m,S)=>(E(),Y(j,{key:S},{default:n(()=>[t(h,{checked:b.value[S],"onUpdate:checked":[de=>b.value[S]=de,d]},{default:n(()=>[M(ge(m),1)]),_:2},1032,["checked","onUpdate:checked"])]),_:2},1024))),128))]),_:1})]),_:1},8,["show"])}}}),yt=z=>(lt("data-v-5c7c3fa7"),z=z(),it(),z),ht={class:"wrap-formula flex h-full bg-#ccc flex-col"},wt={class:"pt-4"},Ct=yt(()=>P("span",{class:"p-x-8px"},"<",-1)),kt={class:"h-200px overflow-auto",style:{flex:"1"}},xt={class:"flex h-full bg-#ccc flex-col"},Nt={class:"flex"},Mt={style:{flex:"1"}},Rt=G({name:"MaterailApprovalFormula"}),St=G({...Rt,setup(z){const g=ae(),D=Ee(),B=He(),k=c(D.query.operateType||"add"),w=c("preparationData"),{message:N}=Ke(["message"]),y=i=>{if(!l.series){N.error("请先选择系列之后再添加物料");return}C.value=!0,w.value=i},C=c(!1),p=c(D.query.rowData&&JSON.parse(D.query.rowData)),l=be(b());function b(){return g.updateMaterialCategory("preparationData",[]),g.updateMaterialCategory("resubmissionData",[]),g.updateMaterialCategory("segmentationData",[]),{productClassification:"",area:"",module:"",series:"",furnaceNum:"",productName:"",specification:"",furnaceType:"",number:"",targetResistivity:0,maxResistivity:0,minResistivity:0,initFeedTotalWeight:"0",initReuseProportion:0,segmentFeedTotalWeight:"0",segmentReuseProportion:0,remark:"",loadInfo:[],initFeedInfo:[],segmentFeedInfo:[]}}const A={module:{required:!0,trigger:["blur","change"],message:"请选择区域"},series:{required:!0,trigger:["blur","input"],message:"请选择系列"},furnaceNum:{required:!0,trigger:["blur","change"],message:"请选择炉台"},targetResistivity:{required:!0,type:"number",trigger:["blur","input"],message:"请输入目标电阻率"},maxResistivity:{required:!0,type:"number",trigger:["blur","input"],message:"请输入电阻率范围"}};c(!1);const I=c(!1),U=()=>{I.value=!I.value},f=c([{key:"materialInfo",title:"装料信息",width:230,align:"center"},{key:"weight",title:"重量",width:40,render:i=>x("span",{},`${i.weight}${i.weight&&"KG"}`)},{key:"active",title:"子料确认",width:100,align:"center",render:(i,a)=>x(J,{justify:"center"},{default:()=>[x($,{size:"small",type:"primary",ghost:!0,onClick:()=>{u.value=!0,s.value="装料信息",h.value=i}},{default:()=>"子料选择"}),x(oe,{onPositiveClick:()=>me("preparationData",a)},{default:()=>"确认删除吗？",trigger:()=>x($,{size:"small",type:"error",ghost:!0},{default:()=>"删除"})})]})}]),v=K(()=>g.preparationData),R=c([{key:"materialInfo",title:"装料信息",width:330,align:"center"},{key:"weight",title:"重量",width:40,render:i=>x("span",{},`${i.weight}${i.weight&&"KG"}`)},{key:"active",title:"子料确认",width:100,align:"center",render:(i,a)=>x(J,{justify:"center"},{default:()=>[x($,{size:"small",type:"primary",ghost:!0,onClick:()=>{u.value=!0,s.value="初始复投信息",h.value=i}},{default:()=>"子料选择"}),x(oe,{onPositiveClick:()=>me("resubmissionData",a)},{default:()=>"确认删除吗？",trigger:()=>x($,{size:"small",type:"error",ghost:!0},{default:()=>"删除"})})]})}]),_=K(()=>g.resubmissionData),d=c([{key:"resubmissionCount",title:"复投次数",width:130,align:"center",render:i=>x("span",{},i.resubmissionCount&&Array.isArray(i.resubmissionCount)&&i.resubmissionCount.join("-"))},{key:"materialInfo",title:"装料信息",width:330,align:"center"},{key:"weight",title:"重量",width:70,align:"center",render:i=>x("span",{},`${i.weight}${i.weight&&"KG"}`)},{key:"active",title:"子料确认",width:70,align:"center",render:(i,a)=>x(J,{justify:"center"},{default:()=>[x($,{size:"small",type:"primary",ghost:!0,onClick:()=>{u.value=!0,s.value="取段复投信息",h.value=i}},{default:()=>"子料选择"}),x(oe,{onPositiveClick:()=>me("segmentationData",a)},{default:()=>"确认删除吗？",trigger:()=>x($,{size:"small",type:"error",ghost:!0},{default:()=>"删除"})})]})}]),r=K(()=>g.segmentationData),u=c(!1),s=c(""),h=c(),j=c([]),V=i=>{l.module=i,H(!0)},W=i=>{l.series=i,l.furnaceNum=""},L=c([]),H=async i=>{const a=await g.querySeriesByModule({module:l.module});a.code===200&&(i&&(l.series=""),L.value=a.data.map(q=>({label:q,value:q})))},m=c(!1),S=()=>{if(!(l.module&&l.series)){N.warning("请选择模块和系列之后再选择炉台");return}m.value=!0},de=i=>{l.furnaceNum=i.join(",")},Fe=i=>{console.log("回调")};ve("module",K(()=>l.module)),ve("series",K(()=>l.series)),ve("subMaterialRowData",h);const ke=c(null),Te=async i=>{var q;i.stopPropagation(),console.log(l),console.log(v),console.log(_),console.log(r);const a={...l,area:l.module,initFeedTotalWeight:le.value,segmentFeedTotalWeight:ie.value,formulaDetailDTOList:[...v.value.map(F=>({...F,type:1,resubmissionCount:""})),..._.value.map(F=>({...F,type:2,resubmissionCount:""})),...r.value.map(F=>{var T;return{...F,type:3,resubmissionCount:Array.isArray(F.resubmissionCount)&&((T=F.resubmissionCount)==null?void 0:T.join("-"))}})]};console.log(k.value),(q=ke.value)==null||q.validate(async F=>{F||(k.value!=="edit"?await g.addFormula(a):(await g.editFormula(a)).code===200&&B.push("/material-approval/approval"))})},le=K(()=>v.value.reduce((i,a)=>i+a.weight,0)+_.value.reduce((i,a)=>i+a.weight,0)+""),ie=K(()=>{if(r.value[0]){const i=JSON.stringify(r.value[0].resubmissionCount);return r.value.filter(a=>JSON.stringify(a.resubmissionCount)===i).reduce((a,q)=>a+q.weight,0)+""}else return"0"}),ne=c(""),ce=c([]),xe=c([]),pe=c(!1);async function $e(i){pe.value=!0;const a=await g.getMaterialFormulaList({current:1,size:999});a.code===200&&(ce.value=a.data.records,xe.value=ce.value.map(q=>({label:q.formulaNum,value:q.id}))),pe.value=!1}const Ae=i=>{ne.value=i,Ne(ce.value.find(a=>a.id===i))},Ne=i=>{console.log(i),Object.assign(l,{productClassification:"",area:i.area,module:i.area,series:i.series,furnaceNum:i.furnaceNum,productName:i.productName,specification:"",furnaceType:"",number:i.number,targetResistivity:Number(i.targetResistivity),maxResistivity:Number(i.maxResistivity),minResistivity:Number(i.minResistivity),initFeedTotalWeight:i.initFeedTotalWeight,initReuseProportion:Number(i.initReuseProportion),segmentFeedTotalWeight:i.segmentFeedTotalWeight,segmentReuseProportion:Number(i.segmentReuseProportion),remark:i.remark},i.id&&{id:Number(i.id)}),g.updateMaterialCategory("preparationData",i.loadInfo.map(a=>({materialInfo:a.materialInfo,weight:a.weight,resubmissionCount:""}))),g.updateMaterialCategory("resubmissionData",i.initFeedInfo.map(a=>({materialInfo:a.materialInfo,weight:a.weight,resubmissionCount:""}))),g.updateMaterialCategory("segmentationData",i.segmentFeedInfo.map(a=>({materialInfo:a.materialInfo,weight:a.weight,resubmissionCount:typeof a.resubmissionCount=="string"?a.resubmissionCount.split("-").map(q=>Number(q)):[]}))),console.log(l)},me=(i,a)=>{g.delMaterialCategory(i,a)};X(()=>D.query,i=>{console.log(i),k.value=i.operateType||"add",k.value==="edit"?Ne(p.value):Object.assign(l,b())},{immediate:!0});const qe=K(()=>({add:"新增配方",edit:"编辑配方"})[k.value]);return Je(async()=>{const i=await g.queryAllModule();i.code===200&&(j.value=i.data.map(a=>({label:a,value:a}))),await H(!1)}),(i,a)=>{const q=et,F=_e,T=we,ee=Re,ze=tt,te=De,Be=ue,Pe=Ce,se=at,fe=Ue;return E(),he("div",ht,[t(se,{bordered:!1,size:"small",class:"card-wrapper m-b-12px"},{default:n(()=>[P("div",{class:"flex justify-between items-center cursor-pointer",onClick:U},[P("h3",null,ge(e(qe)),1),P("div",null,[t(e($),{size:"small",class:"m-r-12px",onClick:Te},{icon:n(()=>[t(q,{icon:"icon-shuaxin-01"})]),default:n(()=>[M(" 保存 ")]),_:1}),t(e($),{size:"small",onClick:Qe(U,["stop"])},{icon:n(()=>[t(q,{icon:"icon-qiehuan"})]),_:1})])]),t(Xe,{name:"fade"},{default:n(()=>[Ye(P("div",wt,[t(Pe,{ref_key:"formRoleRef",ref:ke,model:e(l),rules:A,"label-placement":"left","label-width":100},{default:n(()=>[t(Be,{responsive:"screen","item-responsive":""},{default:n(()=>[e(k)!=="edit"?(E(),Y(T,{key:0,span:"24 m:4",label:"配方查询"},{default:n(()=>[t(F,{value:e(ne),"onUpdate:value":a[0]||(a[0]=o=>O(ne)?ne.value=o:null),filterable:"",placeholder:"输入配方名称",options:e(xe),loading:e(pe),clearable:"",remote:"","on-update:value":Ae,onSearch:$e},null,8,["value","options","loading"])]),_:1})):Me("",!0),t(T,{span:"24 m:4",label:"产品分类",path:"productClassification"},{default:n(()=>[t(ee,{value:e(l).productClassification,"onUpdate:value":a[1]||(a[1]=o=>e(l).productClassification=o),placeholder:"请输入产品分类"},null,8,["value"])]),_:1}),t(T,{span:"24 m:4",label:"区域",path:"module"},{default:n(()=>[t(F,{value:e(l).module,"onUpdate:value":a[2]||(a[2]=o=>e(l).module=o),options:e(j),placeholder:"请选择区域","on-update:value":V},null,8,["value","options"])]),_:1}),t(T,{span:"24 m:4",label:"系列",path:"series"},{default:n(()=>[t(F,{value:e(l).series,"onUpdate:value":a[3]||(a[3]=o=>e(l).series=o),options:e(L),placeholder:"请选择系列","on-update:value":W},null,8,["value","options"])]),_:1}),t(T,{span:"24 m:3",label:"炉台",path:"furnaceNum"},{default:n(()=>[t(ze,{trigger:"hover",style:{maxWidth:"400px"},disabled:!e(l).furnaceNum},{trigger:n(()=>[t(e($),{onClick:S},{default:n(()=>[M("请选择炉台")]),_:1})]),default:n(()=>[M(" 已经勾选炉台："+ge(e(l).furnaceNum),1)]),_:1},8,["disabled"])]),_:1}),t(T,{span:"24 m:4",label:"产品",path:"productName"},{default:n(()=>[t(F,{value:e(l).productName,"onUpdate:value":a[4]||(a[4]=o=>e(l).productName=o),options:[],placeholder:"请选择产品"},null,8,["value"])]),_:1}),t(T,{span:"24 m:4",label:"规格型号",path:"specification"},{default:n(()=>[t(F,{value:e(l).specification,"onUpdate:value":a[5]||(a[5]=o=>e(l).specification=o),options:[],placeholder:"请选择规格型号"},null,8,["value"])]),_:1}),t(T,{span:"24 m:4",label:"炉型热场",path:"furnaceType"},{default:n(()=>[t(F,{value:e(l).furnaceType,"onUpdate:value":a[6]||(a[6]=o=>e(l).furnaceType=o),options:[],placeholder:"请选择炉型热场"},null,8,["value"])]),_:1}),t(T,{span:"24 m:4",label:"编号",path:"number"},{default:n(()=>[t(ee,{value:e(l).number,"onUpdate:value":a[7]||(a[7]=o=>e(l).number=o),placeholder:"请输入编号"},null,8,["value"])]),_:1}),t(T,{span:"24 m:4",label:"目标电阻率",path:"targetResistivity"},{default:n(()=>[t(te,{value:e(l).targetResistivity,"onUpdate:value":a[8]||(a[8]=o=>e(l).targetResistivity=o),precision:2,step:.1,placeholder:"请输入目标电阻率"},null,8,["value"])]),_:1}),t(T,{span:"24 m:5",label:"电阻率范围",path:"maxResistivity"},{default:n(()=>[t(te,{value:e(l).minResistivity,"onUpdate:value":a[9]||(a[9]=o=>e(l).minResistivity=o),precision:2,step:.1,min:0,max:e(l).maxResistivity},null,8,["value","max"]),Ct,t(te,{value:e(l).maxResistivity,"onUpdate:value":a[10]||(a[10]=o=>e(l).maxResistivity=o),precision:2,step:.1,min:e(l).minResistivity},null,8,["value","min"])]),_:1}),t(T,{span:"24 m:24",label:"备注",path:"remark"},{default:n(()=>[t(ee,{value:e(l).remark,"onUpdate:value":a[11]||(a[11]=o=>e(l).remark=o)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])],512),[[Ze,e(I)]])]),_:1})]),_:1}),P("div",kt,[P("div",xt,[P("div",Nt,[t(se,{bordered:!1,title:"装料信息"},{"header-extra":n(()=>[t(e($),{type:"primary",onClick:a[12]||(a[12]=o=>y("preparationData"))},{default:n(()=>[M(" 添加 ")]),_:1})]),default:n(()=>[t(fe,{columns:e(f),data:e(v),class:"wrap-table__custom h-200px text-10px",size:"small","flex-height":"",remote:"","row-key":o=>o.materialClassification},null,8,["columns","data","row-key"])]),_:1}),t(se,{bordered:!1,title:"初始复投信息"},{"header-extra":n(()=>[t(ee,{value:e(le),"onUpdate:value":a[13]||(a[13]=o=>O(le)?le.value=o:null),disabled:"",style:{width:"100px","margin-right":"12px"}},null,8,["value"]),t(te,{value:e(l).initReuseProportion,"onUpdate:value":a[14]||(a[14]=o=>e(l).initReuseProportion=o),precision:2,step:.1,min:0,max:100,class:"w-110px m-r-12px"},{suffix:n(()=>[M(" % ")]),_:1},8,["value"]),t(e($),{type:"primary",onClick:a[15]||(a[15]=o=>y("resubmissionData"))},{default:n(()=>[M(" 添加 ")]),_:1})]),default:n(()=>[t(fe,{columns:e(R),data:e(_),size:"small",class:"wrap-table__custom h-200px text-10px","flex-height":"",remote:"","scroll-x":640,"row-key":o=>o.materialClassification},null,8,["columns","data","row-key"])]),_:1})]),P("div",Mt,[t(se,{bordered:!1,title:"取段复投信息",class:"h-full"},{"header-extra":n(()=>[t(ee,{value:e(ie),"onUpdate:value":a[16]||(a[16]=o=>O(ie)?ie.value=o:null),disabled:"",style:{width:"100px","margin-right":"12px"}},null,8,["value"]),t(te,{value:e(l).segmentReuseProportion,"onUpdate:value":a[17]||(a[17]=o=>e(l).segmentReuseProportion=o),precision:2,step:.1,min:0,max:100,class:"w-110px m-r-12px"},{suffix:n(()=>[M(" % ")]),_:1},8,["value"]),t(e($),{type:"primary",onClick:a[18]||(a[18]=o=>y("segmentationData"))},{default:n(()=>[M(" 添加 ")]),_:1})]),default:n(()=>[t(fe,{columns:e(d),data:e(r),size:"small",class:"wrap-table__custom h-full text-10px","flex-height":"",remote:"","scroll-x":640,"row-key":o=>o.materialClassification},null,8,["columns","data","row-key"])]),_:1})])])]),t(dt,{visible:e(C),"onUpdate:visible":a[19]||(a[19]=o=>O(C)?C.value=o:null),"material-category":e(w),series:e(l).series,onSubmitted:Fe},null,8,["visible","material-category","series"]),t(vt,{visible:e(u),"onUpdate:visible":a[20]||(a[20]=o=>O(u)?u.value=o:null),"sub-material-title":e(s)},null,8,["visible","sub-material-title"]),t(_t,{visible:e(m),"onUpdate:visible":a[21]||(a[21]=o=>O(m)?m.value=o:null),"furnace-num":e(l).furnaceNum,onSubmitted:de},null,8,["visible","furnace-num"])])}}});const jt=nt(St,[["__scopeId","data-v-5c7c3fa7"]]);export{jt as default};
