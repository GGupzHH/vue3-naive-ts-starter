import{b$ as O,S as E,r as C,j as T,c0 as D}from"./index-c17896f8.js";function F(n){const p=C(!1),{apiFn:P,apiParams:k,transformer:S,immediate:z=!0,getColumnChecks:l,getColumns:g}=n,i=E({...k}),d=C(n.columns()),y=C([]),u=C(l(n.columns())),_=T(()=>g(d.value,u.value));function m(){d.value=n.columns();const c=new Map(u.value.map(a=>[a.key,a.checked])),e=l(d.value);u.value=e.map(a=>({...a,checked:c.get(a.key)??a.checked}))}async function h(){var t,o;p.value=!0;const c=f(i),e=await P(c),a=S(e);y.value=((t=a.data)==null?void 0:t.records)||a.data||[],a.data.length,await((o=n.onFetched)==null?void 0:o.call(n,a)),p.value=!1}function f(c){const e={};return Object.entries(c).forEach(([a,t])=>{t!=null&&(e[a]=t)}),e}function v(c){Object.assign(i,c)}function r(){Object.assign(i,k),h()}return z&&h(),{loading:p,data:y,columns:_,columnChecks:u,reloadColumns:m,getData:h,searchParams:i,updateSearchParams:v,resetSearchParams:r}}function N(n){const p=O(),{apiFn:P,apiParams:k,immediate:S,showTotal:z}=n,l="__selection__",g="__expand__",{loading:i,data:d,columns:y,columnChecks:u,reloadColumns:_,getData:m,searchParams:h,updateSearchParams:f,resetSearchParams:v}=F({apiFn:P,apiParams:k,columns:n.columns,transformer:e=>{const{records:a=[],current:t=1,size:o=10,total:s=0}=e.data||{},b=a.map((x,j)=>({...x,index:(t-1)*o+j+1}));return{data:b.length?b:e.data||[],pageNum:t,pageSize:o,total:s}},getColumnChecks:e=>{const a=[];return e.forEach(t=>{w(t)?a.push({key:t.key,title:t.title,checked:!0}):t.type==="selection"?a.push({key:l,title:"勾选",checked:!0}):t.type==="expand"&&a.push({key:g,title:"导出",checked:!0})}),a},getColumns:(e,a)=>{const t=new Map;return e.forEach(s=>{w(s)?t.set(s.key,s):s.type==="selection"?t.set(l,s):s.type==="expand"&&t.set(g,s)}),a.filter(s=>s.checked).map(s=>t.get(s.key))},onFetched:async e=>{const{pageNum:a,pageSize:t,total:o}=e;c({page:a,pageSize:t,itemCount:o})},immediate:S}),r=E({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20,25,30],onUpdatePage:async e=>{r.page=e,f({current:e,size:r.pageSize}),await m()},onUpdatePageSize:async e=>{r.pageSize=e,r.page=1,f({current:r.page,size:e}),await m()},...z?{prefix:e=>`共${e.itemCount}条`}:{}});function c(e){Object.assign(r,e)}return D(()=>{p.stop()}),{loading:i,data:d,columns:y,columnChecks:u,reloadColumns:_,pagination:r,updatePagination:c,getData:m,searchParams:h,updateSearchParams:f,resetSearchParams:v}}function w(n){return!!n.key}export{N as u};
