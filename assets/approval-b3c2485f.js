import{g as w,P as C,r as f,l as t,aa as c,al as N,a9 as K,A as z,B as A,I as s,J as d,K as r,ad as v,ac as M,ab as W,ag as B,af as G}from"./index-c17896f8.js";import{u as D}from"./index-1e2be4ca.js";import{u as E}from"./table-a84f3163.js";import{_ as L}from"./DataTable-19a8255a.js";import"./Forward-600c26c3.js";const S={class:"flex-vertical-stretch gap-16px overflow-hidden <sm:overflow-auto"},J=w({name:"MaterailApproval"}),Q=w({...J,setup(U){const h=D(),x=C(),I=()=>{g.value="add",y()},y=e=>{x.push({path:"/material-approval/formula",query:{operateType:g.value,rowData:e?JSON.stringify(e):""}})},p=f([]),R=async e=>{await h.delMaterialFormulaList(e.id),k()},{columns:$,columnChecks:m,data:F,loading:_,pagination:T,getData:k}=E({apiFn:h.getMaterialFormulaList,apiParams:{current:1,size:10},columns:()=>[{type:"selection",fixed:"left"},{key:"formulaNum",title:"配方编码",width:80,align:"center"},{key:"approvalBatch",title:"配方审批版本",width:80,align:"center"},{key:"area",title:"区域",width:50,align:"left"},{key:"series",title:"系列",width:50,align:"center"},{key:"furnaceNum",title:"炉台数",width:140,align:"center"},{key:"productName",title:"产品",width:100,align:"center"},{key:"specification",title:"规格型号",width:80,align:"center"},{key:"furnaceType",title:"炉型热厂",width:80,align:"center"},{key:"number",title:"编号",width:90,align:"center"},{key:"targetResistivity",title:"目标电阻率",width:70,align:"center"},{key:"minResistivity-maxResistivity",title:"电阻率范围",width:100,align:"center",render:e=>t("span",{},`${e.minResistivity} - ${e.maxResistivity}`)},{key:"loadInfo",title:"装料信息",width:240,align:"center",render:e=>t("div",{},{default:()=>e.loadInfo&&e.loadInfo.map(n=>t("div",{},`${n.materialInfo}， ${n.weight}KG`))})},{key:"initFeedInfo",title:"初始复投信息",width:240,align:"center",render:e=>t("div",{},{default:()=>e.loadInfo&&e.loadInfo.map(n=>t("div",{},`${n.materialInfo}， ${n.weight}KG`))})},{key:"initFeedTotalWeight",title:"初始总投料量",width:100,align:"center",render:e=>t("span",{},`${e.initFeedTotalWeight}${e.initFeedTotalWeight&&"KG"}`)},{key:"initReuseProportion",title:"初始回用占比",width:100,align:"center",render:e=>t("span",{},`${e.initReuseProportion}${e.initReuseProportion&&"%"}`)},{key:"segmentFeedInfo",title:"取段复投信息",width:240,align:"center",render:e=>t("div",{},{default:()=>P(e.segmentFeedInfo).map(i=>t("div",{},{default:()=>[t("div",{class:"font-bold text-12px text-left"},`${i.resubmissionCount}复投：`),t("div",{},{default:()=>i.materialInfo.map((a,o)=>t("div",{},{default:()=>[t("strong",{},a),t("span",{},`${i.weight[o]}KG`)]}))})]}))})},{key:"segmentFeedTotalWeight",title:"取段投料重量",width:100,align:"center",render:e=>t("span",{},`${e.segmentFeedTotalWeight}${e.segmentFeedTotalWeight&&"KG"}`)},{key:"segmentReuseProportion",title:"取段回用占比",width:100,align:"center",render:e=>t("span",{},`${e.segmentReuseProportion}${e.segmentReuseProportion&&"%"}`)},{key:"remark",title:"备注",width:120,align:"center"},{key:"active",title:"操作",width:280,align:"center",fixed:"right",render:e=>t(K,{justify:"center"},{default:()=>[t(c,{size:"small",type:"primary",ghost:!0,onClick:()=>{g.value="edit",y(e)}},{default:()=>"编辑"}),t(c,{size:"small",type:"primary",ghost:!0,onClick:()=>{b.value={...e}}},{default:()=>"复投车"}),t(N,{onPositiveClick:()=>R(e)},{default:()=>"确认删除吗？",trigger:()=>t(c,{size:"small",type:"error",ghost:!0},{default:()=>"删除"})})]})}],immediate:void 0}),g=f("add"),b=f(void 0),P=e=>{const n=[],i=new Map;return e.forEach(a=>{const{resubmissionCount:o}=a;if(!i.has(o))i.set(o,{...a,materialInfo:[a.materialInfo],weight:[a.weight]});else{const u=i.get(o);u.materialInfo.push(a.materialInfo),u.weight.push(a.weight)}}),i.forEach(a=>n.push(a)),n};return(e,n)=>{const i=W,a=B,o=L,u=G;return z(),A("div",S,[s(u,{title:"配方审批版本-20249344-1",bordered:!1,size:"small",class:"card-wrapper sm:flex-1-hidden"},{"header-extra":d(()=>[s(a,{columns:r(m),"onUpdate:columns":n[0]||(n[0]=l=>v(m)?m.value=l:null),"is-delete-btn":!1,loading:r(_),"add-btn-text":"添加配方",onAdd:I,onRefresh:r(k)},{suffix:d(()=>[s(r(c),{size:"small",ghost:"",type:"error"},{icon:d(()=>[s(i,{icon:"icon-shanchu1"})]),default:d(()=>[M(" 审批 ")]),_:1})]),_:1},8,["columns","loading","onRefresh"])]),default:d(()=>[s(o,{"checked-row-keys":r(p),"onUpdate:checkedRowKeys":n[1]||(n[1]=l=>v(p)?p.value=l:null),columns:r($),data:r(F),size:"small","flex-height":!0,"scroll-x":2700,loading:r(_),pagination:r(T),"row-key":l=>l.id,class:"sm:h-full text-10px"},null,8,["checked-row-keys","columns","data","loading","pagination","row-key"])]),_:1})])}}});export{Q as default};
